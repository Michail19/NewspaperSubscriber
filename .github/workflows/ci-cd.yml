name: Review Branch Tests

on:
  push:
    branches: [ review ]
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        service: [ "SubscriptionService" ]

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'

      - name: Run tests for ${{ matrix.service }}
        working-directory: ${{ matrix.service }}
        run: |
          chmod +x gradlew
          ./gradlew test --no-daemon

  create_pull_request:
    needs: test
    runs-on: ubuntu-latest
    if: success()

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create Pull Request to main
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.PAT_TOKEN }}
          branch: review
          base: main
          title: "Auto PR: Review → Main"
          body: |
            ✅ All tests passed on branch **review**
            This PR was automatically generated by GitHub Actions.
